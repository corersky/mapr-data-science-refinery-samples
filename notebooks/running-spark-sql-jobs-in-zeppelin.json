{"paragraphs":[{"title":"Download spending dataset into HDFS","text":"%md\n## This section contains code sample for Apache Spark SQL queries that you can run in your Apache Zeppelin notebook. \nYou can run this example using either the Livy or Spark interpreter. \n\n[MapR Data Science Refinery Documentation](https://mapr.com/docs/61/Zeppelin/ZeppelinSpark.html)\n\n#### Pre-requisistes\n\nBefore running these examples, depending on whether you are using the [Livy](https://mapr.com/docs/61/Zeppelin/ConfigureLivyInterpreter.html#task_t1d_4yj_qbb) or [Spark](https://mapr.com/docs/61/Zeppelin/ConfigureSparkInterpreter.html#task_t1d_4yj_qbb) interpreter, make sure you have configured the interpreter.\n","user":"mapr","dateUpdated":"2019-04-26T07:38:16-0700","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"title":false,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>This section contains code sample for Apache Spark SQL queries that you can run in your Apache Zeppelin notebook.</h2>\n<p>You can run this example using either the Livy or Spark interpreter. </p>\n<p><a href=\"https://mapr.com/docs/61/Zeppelin/ZeppelinSpark.html\">MapR Data Science Refinery Documentation</a></p>\n<h4>Pre-requisistes</h4>\n<p>Before running these examples, depending on whether you are using the <a href=\"https://mapr.com/docs/61/Zeppelin/ConfigureLivyInterpreter.html#task_t1d_4yj_qbb\">Livy</a> or <a href=\"https://mapr.com/docs/61/Zeppelin/ConfigureSparkInterpreter.html#task_t1d_4yj_qbb\">Spark</a> interpreter, make sure you have configured the interpreter.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1556289213775_-371857647","id":"20150522-145401_1470736167","dateCreated":"2019-04-26T07:33:33-0700","dateStarted":"2019-04-26T07:38:16-0700","dateFinished":"2019-04-26T07:38:16-0700","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:27965"},{"title":"Download data and import into HDFS","text":"%sh\n\n#remove existing copies of dataset from HDFS\nhadoop fs -rm  /tmp/expenses.csv\n\n#fetch the dataset\nwget https://data.gov.au/dataset/f84b9baf-c1c1-437c-8c1e-654b2829848c/resource/88399d53-d55c-466c-8f4a-6cb965d24d6d/download/healthexpenditurebyareaandsource.csv -O /tmp/expenses.csv\n\n#remove header\nsed -i '1d' /tmp/expenses.csv\n#remove empty fields\nsed -i \"s/,,,,,//g\" /tmp/expenses.csv\nsed -i '/^\\s*$/d' /tmp/expenses.csv\n\n#put data into HDFS\nhadoop fs -put /tmp/expenses.csv /tmp\nhadoop fs -ls -h /tmp/expenses.csv\nrm /tmp/expenses.csv","user":"mapr","dateUpdated":"2019-04-26T07:38:16-0700","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"title":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"SLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/opt/mapr/hadoop/hadoop-2.7.0/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: Found binding in [jar:file:/opt/mapr/lib/slf4j-log4j12-1.7.12.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]\nrm: `/tmp/expenses.csv': No such file or directory\n--2019-04-26 07:38:20--  https://data.gov.au/dataset/f84b9baf-c1c1-437c-8c1e-654b2829848c/resource/88399d53-d55c-466c-8f4a-6cb965d24d6d/download/healthexpenditurebyareaandsource.csv\nResolving data.gov.au (data.gov.au)... 54.66.219.79, 54.153.135.115, 3.104.187.38, ...\nConnecting to data.gov.au (data.gov.au)|54.66.219.79|:443... connected.\nHTTP request sent, awaiting response... 301 Moved Permanently\nLocation: https://data.gov.au/data/dataset/f84b9baf-c1c1-437c-8c1e-654b2829848c/resource/88399d53-d55c-466c-8f4a-6cb965d24d6d/download/healthexpenditurebyareaandsource.csv [following]\n--2019-04-26 07:38:22--  https://data.gov.au/data/dataset/f84b9baf-c1c1-437c-8c1e-654b2829848c/resource/88399d53-d55c-466c-8f4a-6cb965d24d6d/download/healthexpenditurebyareaandsource.csv\nReusing existing connection to data.gov.au:443.\nHTTP request sent, awaiting response... 200 OK\nLength: 469727 (459K) [text/csv]\nSaving to: '/tmp/expenses.csv'\n\n     0K .......... .......... .......... .......... .......... 10% 67.7K 6s\n    50K .......... .......... .......... .......... .......... 21%  135K 4s\n   100K .......... .......... .......... .......... .......... 32% 13.4M 2s\n   150K .......... .......... .......... .......... .......... 43% 51.3M 1s\n   200K .......... .......... .......... .......... .......... 54%  136K 1s\n   250K .......... .......... .......... .......... .......... 65% 18.2M 1s\n   300K .......... .......... .......... .......... .......... 76% 49.8M 0s\n   350K .......... .......... .......... .......... .......... 87%  136K 0s\n   400K .......... .......... .......... .......... .......... 98% 77.9M 0s\n   450K ........                                              100% 44.3M=1.9s\n\n2019-04-26 07:38:24 (247 KB/s) - '/tmp/expenses.csv' saved [469727/469727]\n\nSLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/opt/mapr/hadoop/hadoop-2.7.0/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: Found binding in [jar:file:/opt/mapr/lib/slf4j-log4j12-1.7.12.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]\nSLF4J: Class path contains multiple SLF4J bindings.\nSLF4J: Found binding in [jar:file:/opt/mapr/hadoop/hadoop-2.7.0/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: Found binding in [jar:file:/opt/mapr/lib/slf4j-log4j12-1.7.12.jar!/org/slf4j/impl/StaticLoggerBinder.class]\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]\n-rwxr-xr-x   3 mapr mapr    456.4 K 2019-04-26 07:38 /tmp/expenses.csv\n"}]},"apps":[],"jobName":"paragraph_1556289213775_-1275590059","id":"20150524-025502_1843984349","dateCreated":"2019-04-26T07:33:33-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:27966","dateFinished":"2019-04-26T07:38:28-0700","dateStarted":"2019-04-26T07:38:16-0700"},{"title":"Read csv into RDD and count","text":"\nval dataset=sc.textFile(\"/tmp/expenses.csv\")\ndataset.count()\ndataset.first()","user":"mapr","dateUpdated":"2019-04-26T07:38:28-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"dataset: org.apache.spark.rdd.RDD[String] = /tmp/expenses.csv MapPartitionsRDD[1] at textFile at <console>:25\nres4: Long = 6778\nres5: String = 1997-98,NSW,Administration,Government,Australian Government,315\n"}]},"apps":[],"jobName":"paragraph_1556289213775_-1451777390","id":"20150522-145506_1520223608","dateCreated":"2019-04-26T07:33:33-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:27967","dateFinished":"2019-04-26T07:40:50-0700","dateStarted":"2019-04-26T07:38:28-0700","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://node3.cluster.com:8088/proxy/application_1556280881711_0017//jobs","http://node3.cluster.com:8088/proxy/application_1556280881711_0017//jobs"],"interpreterSettingId":"spark"}}},{"title":"Register RDD as table","text":"\ncase class Health (year:  String, state: String, category:String, funding_src1: String, funding_scr2: String, spending: Integer)\nval health = dataset.map(k=>k.split(\",\")).map(\n    k => Health(k(0),k(1),k(2),k(3), k(4), k(5).toInt)\n    )\n// toDF() works only in spark 1.3.0.\n// For spark 1.1.x and spark 1.2.x,\n// use below instead:\n// health.registerTempTable(\"health_table\")\nhealth.toDF().registerTempTable(\"health_table\")","user":"mapr","dateUpdated":"2019-04-26T07:40:50-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class Health\nhealth: org.apache.spark.rdd.RDD[Health] = MapPartitionsRDD[8] at map at <console>:33\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"}]},"apps":[],"jobName":"paragraph_1556289213775_237507127","id":"20150522-145554_1659286336","dateCreated":"2019-04-26T07:33:33-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:27968","dateFinished":"2019-04-26T07:41:02-0700","dateStarted":"2019-04-26T07:40:51-0700"},{"title":"Spending (in billions) by state","text":"%sql\nselect state, sum(spending)/1000 SpendinginBillions \nfrom health_table \ngroup by state \norder by SpendinginBillions desc","user":"mapr","dateUpdated":"2019-04-26T07:41:02-0700","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":4,"editorMode":"ace/mode/sql","editorHide":false,"fontSize":9,"title":true,"results":[{"graph":{"mode":"pieChart","height":300,"optionOpen":false,"keys":[{"name":"state","index":0,"aggr":"sum"}],"values":[{"name":"SpendinginBillions","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"state","index":0,"aggr":"sum"},"yAxis":{"name":"SpendinginBillions","index":1,"aggr":"sum"}}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"state\tSpendinginBillions\nNSW\t482.366\nVIC\t360.217\nQLD\t289.676\nWA\t149.887\nSA\t114.623\nTAS\t34.294\nACT\t28.26\nNT\t18.915\n"}]},"apps":[],"jobName":"paragraph_1556289213776_1034734892","id":"20150522-145707_2030296925","dateCreated":"2019-04-26T07:33:33-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:27969","dateFinished":"2019-04-26T07:41:14-0700","dateStarted":"2019-04-26T07:41:02-0700","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://node3.cluster.com:8088/proxy/application_1556280881711_0017//jobs"],"interpreterSettingId":"spark"}}},{"title":"Spending (In Billions) By Year","text":"%sql\nselect year,sum(spending)/1000 SpendinginBillions \nfrom health_table \ngroup by year \norder by SpendinginBillions\n","user":"mapr","dateUpdated":"2019-04-26T07:41:23-0700","config":{"tableHide":false,"editorSetting":{},"colWidth":4,"editorMode":"ace/mode/sql","editorHide":false,"fontSize":9,"title":true,"results":[{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"year","index":0,"aggr":"sum"}],"values":[{"name":"SpendinginBillions","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"year","index":0,"aggr":"sum"},"yAxis":{"name":"SpendinginBillions","index":1,"aggr":"sum"}},"setting":{"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"year\tSpendinginBillions\n1997-98\t65.705\n1998-99\t69.54\n1999-00\t73.084\n2000-01\t78.687\n2001-02\t82.895\n2002-03\t87.702\n2003-04\t90.617\n2004-05\t96.503\n2005-06\t99.076\n2006-07\t104.979\n2007-08\t112.106\n2008-09\t119.757\n2009-10\t124.767\n2010-11\t132.572\n2011-12\t140.248\n"}]},"apps":[],"jobName":"paragraph_1556289213776_603459512","id":"20150522-150006_2004946034","dateCreated":"2019-04-26T07:33:33-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:27970","dateFinished":"2019-04-26T07:41:18-0700","dateStarted":"2019-04-26T07:41:14-0700","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://node3.cluster.com:8088/proxy/application_1556280881711_0017//jobs"],"interpreterSettingId":"spark"}}},{"title":"Spending (in billions) by area","text":"%sql\nselect category, sum(spending)/1000 SpendinginBillions \nfrom health_table \ngroup by category \norder by SpendinginBillions desc","user":"mapr","dateUpdated":"2019-04-26T07:41:18-0700","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":4,"editorMode":"ace/mode/sql","editorHide":false,"fontSize":9,"title":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"category","index":0,"aggr":"sum"}],"values":[{"name":"SpendinginBillions","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"category","index":0,"aggr":"sum"},"yAxis":{"name":"SpendinginBillions","index":1,"aggr":"sum"}},"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"category":"string","SpendinginBillions":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}],"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"category\tSpendinginBillions\nPublic hospitals\t445.845\nMedical services\t272.507\nPrivate hospitals\t121.022\nBenefit-paid pharmaceuticals\t104.221\nDental services\t90.786\nCommunity health\t75.765\nCapital expenditure\t72.698\nAll other medications\t70.508\nOther health practitioners\t51.382\nAdministration\t41.029\nResearch\t40.074\nAids and appliances\t37.155\nPatient transport services\t28.174\nPublic health\t27.072\nMedical expense tax rebate\t0.0\n"}]},"apps":[],"jobName":"paragraph_1556289213776_1745245976","id":"20150522-150103_460493658","dateCreated":"2019-04-26T07:33:33-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:27971","dateFinished":"2019-04-26T07:41:23-0700","dateStarted":"2019-04-26T07:41:19-0700","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://node3.cluster.com:8088/proxy/application_1556280881711_0017//jobs"],"interpreterSettingId":"spark"}}},{"text":"%md\n\nHealth expenditure in Australia data\n\n```\n  This dataset is public available for research. \n    Health expenditure in Australia\n    Health expenditure occurs where money is spent on health goods and services. It occurs at different levels of government, \n    as well as by non-government entities such as private health insurers and individuals.\n    In many cases, funds pass through a number of different entities before they are ultimately spent by providers \n    (such as hospitals, general practices and pharmacies) on health goods and services.\n    The term ‘health expenditure’ in this context relates to all funds given to, or for, providers of health goods and services. \n    It includes the funds provided by the Australian Government to the state and territory governments, as well as the funds provided by the state and territory governments to providers.\n\n    This data has been superseded, for more recent data on health expenditure, please the AIHW page on health expenditure.\n\nThis dataset was originally found on data.gov.au\n    https://data.gov.au/data/dataset/f84b9baf-c1c1-437c-8c1e-654b2829848c\n```","user":"mapr","dateUpdated":"2019-04-26T07:41:23-0700","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Health expenditure in Australia data</p>\n<pre><code>  This dataset is public available for research. \n    Health expenditure in Australia\n    Health expenditure occurs where money is spent on health goods and services. It occurs at different levels of government, \n    as well as by non-government entities such as private health insurers and individuals.\n    In many cases, funds pass through a number of different entities before they are ultimately spent by providers \n    (such as hospitals, general practices and pharmacies) on health goods and services.\n    The term ‘health expenditure’ in this context relates to all funds given to, or for, providers of health goods and services. \n    It includes the funds provided by the Australian Government to the state and territory governments, as well as the funds provided by the state and territory governments to providers.\n\n    This data has been superseded, for more recent data on health expenditure, please the AIHW page on health expenditure.\n\nThis dataset was originally found on data.gov.au\n    https://data.gov.au/data/dataset/f84b9baf-c1c1-437c-8c1e-654b2829848c\n</code></pre>\n</div>"}]},"apps":[],"jobName":"paragraph_1556289213776_-1311553657","id":"20150522-151420_2114334426","dateCreated":"2019-04-26T07:33:33-0700","dateStarted":"2019-04-26T07:41:23-0700","dateFinished":"2019-04-26T07:41:23-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:27972"},{"text":"%md\n","user":"mapr","dateUpdated":"2019-04-26T07:41:23-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1556289230315_-299724661","id":"20190426-073350_185422550","dateCreated":"2019-04-26T07:33:50-0700","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:27973"}],"name":"Running Spark SQL Jobs in Zeppelin","id":"2EBAA4XNV","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"python:shared_process":[],"sh:shared_process":[],"spark:shared_process":[],"hive:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":true,"looknfeel":"default","personalizedMode":"false"},"info":{}}